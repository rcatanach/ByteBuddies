<!DOCTYPE html>
<html lang="en">
<head>
  <title>Upload Images Page</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <style>
    body,h1,h2,h3,h4,h5,h6 {font-family: "Lato", sans-serif}
    .w3-bar,h1,button {font-family: "Montserrat", sans-serif}

    /* Add your custom styles here */

    /* ... (your additional styles for upload_images.html) ... */

  </style>


<style>
  #imageInput { /*SUPPORT FOR BUTTON*/
    margin-top: 100px; /* Adds 100 pixels of margin at the top */
  }

  #uploadButton {
    margin-top: 100px; /* Adds 100 pixels of margin at the top */
  }
</style>

  

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      var includeHTML = function() {
        var z, i, elmnt, file, xhttp;
        z = document.getElementsByTagName("*");
        for (i = 0; i < z.length; i++) {
          elmnt = z[i];
          file = elmnt.getAttribute("w3-include-html");
          if (file) {
            xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
              if (this.readyState == 4 && this.status == 200) {
                elmnt.innerHTML = this.responseText;
                elmnt.removeAttribute("w3-include-html");
                includeHTML();
              }
            }
            xhttp.open("GET", file, true);
            xhttp.send();
            return;
          }
        }
      };
      includeHTML();
    });
  </script>
</head>

<body>

<!-- Include navbar -->

<div w3-include-html="navbar.html"></div>


<!-- Your content for upload_images.html goes here -->
<!--Create buttons to select and upload image-->
<input type="file" id="imageInput" accept="image/*" />
<button id="uploadButton">Upload Image</button>




<script type="module" src="firebase.js"></script>
<script type="module">
  import { storage, firebaseApp, auth, ref, storageRef, uploadBytes, getDownloadURL, db, doc, setDoc, getDoc, getDocs, collection } from './firebase.js';
  const userEmail = localStorage.getItem('userEmail');


  document.addEventListener("DOMContentLoaded", function () {
  const imageInput = document.getElementById('imageInput');
  const uploadButton = document.getElementById('uploadButton');

    uploadButton.addEventListener('click', () => {
      const file = imageInput.files[0];

      if (file) {
        // Generate a unique file name (if needed)
        const uniqueFileName = `${Date.now()}-${file.name}`;
        const imagesRef = ref(storage, 'images');
        const fileRef = ref(storage, 'images/' +uniqueFileName)

        uploadBytes(fileRef, file)
        .then((snapshot) => {
          console.log('Image uploaded successfully:', snapshot);
          // get the downloadURL to store in firestore
          getDownloadURL(ref(storage, fileRef))
          .then((downloadURL) =>  {
            
            const userRef = doc(db,"users", userEmail);

            setDoc(doc(userRef, "clothing", uniqueFileName), {
              color: "Red",
              length: "long",
              image: downloadURL
            }).then(function() {
              console.log("clothing created");
            });// end then
          })//end then
          .catch((error) => {
            // Handle any errors
          });//end catch
        })//end then
        .catch((error) => {
          console.error('Image upload error:', error);
        });//end catch
      } else {
        console.error('No file selected for upload');
      }
    });
  });

  const clothingRef = collection(db, "users", userEmail, "clothing")
  const querySnapshot = await getDocs(clothingRef);
  querySnapshot.forEach((doc) => {
    // doc.data() is never undefined for query doc snapshots
    console.log(doc.id, " => ", doc.data());
  });


</script>
<!-- ... (rest of your upload_images.html content) ... -->

</body>
</html>

